# Сервис "Одноразовые секреты"

Сервис на FastAPI для безопасного хранения и передачи конфиденциальных данных. Секреты хранятся в зашифрованном виде и могут быть прочитаны только один раз.

## Особенности

- Шифрование всех секретных данных
- Одноразовый доступ к секретам (после первого чтения секрет становится недоступен)
- Возможность установки времени жизни для секретов (TTL)
- Защита секретов паролем
- Логирование всех операций в PostgreSQL
- Кеширование для быстрого доступа

## Требования

- Docker и Docker Compose (для запуска через контейнеры)
- Python 3.11+ (для локальной разработки)
- PostgreSQL
- Redis 

## Быстрый старт

### Запуск через Docker

1. Клонируйте репозиторий
2. Создайте `.env` файл на основе `.env.example`
3. Запустите:
```bash
docker-compose up -d
```
4. API будет доступен по адресу http://localhost:8000

### Локальный запуск

1. Установите Python 3.11+
2. Клонируйте репозиторий
3. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
venv\Scripts\activate     # для Windows
```
4. Установите зависимости:
```bash
pip install -r requirements.txt
```
5. Создайте `.env` файл на основе `.env.example`
6. Запустите PostgreSQL и Redis (локально или через Docker)
7. Запустите миграции:
```bash
alembic upgrade head
```
8. Запустите приложение:
```bash
uvicorn app.main:app --reload
```
9. API будет доступен по адресу http://localhost:8000

## API Endpoints

### Создание секрета

```
POST /secret
```

**Тело запроса:**
```json
{
  "secret": "конфиденциальные_данные",
  "passphrase": "my_passphrase",        // опционально
  "ttl_seconds": 3600                   // опционально, время жизни в секундах
}
```

**Пример ответа:**
```json
{
  "secret_key": "уникальный_идентификатор"
}
```

### Получение секрета

```
GET /secret/{secret_key}
```

**Пример ответа:**
```json
{
  "secret": "конфиденциальные_данные"
}
```

После первого запроса секрет становится недоступен.

### Удаление секретов

```
DELETE /secret/{secret_key}
```

**Тело запроса (если секрет защищен паролем):**
```json
{
  "passphrase": "my_passphrase"
}
```

**Пример ответа:**
```json
{
  "status": "secret_deleted"
}
```

## Безопасность

- **Шифрование данных**: Секреты шифруются с использованием алгоритма AES через библиотеку Fernet
- **Защита паролем**: Пароли хранятся в виде хешей (SHA-256)
- **Одноразовый доступ**: После первого чтения секрет становится недоступным
- **HTTP-заголовки**: Устанавливаются для предотвращения кеширования на стороне клиента
- **TTL**: Секреты автоматически становятся недоступны по истечении срока действия

## Тестирование

Для запуска тестов выполните:

```bash
pytest
```

Тесты используют SQLite в памяти и не требуют внешних зависимостей.

## Документация API

Документация доступна через Swagger/OpenAPI по адресу `/docs` после запуска сервиса.

## Дополнительные возможности

1. **Защита паролем**: Секреты могут быть защищены паролем для дополнительного уровня безопасности
2. **Настройка TTL**: Можно указать время жизни секрета от 1 минуты до нескольких дней
3. **Логирование действий**: Все операции с секретами логируются для аудита

## Ограничения

1. Сервис предназначен для хранения небольших конфиденциальных данных, не для больших файлов
2. По умолчанию секреты хранятся 1 день, если не указан другой TTL
3. Минимальное время кеширования - 5 минут (300 секунд)

## Дальнейшие улучшения

1. Добавление аутентификации/авторизации для создания секретов
2. Реализация периодической очистки просроченных секретов
3. Добавление статистики использования
4. Интеграция с системами управления секретами
5. Добавление квот на количество/размер секретов 